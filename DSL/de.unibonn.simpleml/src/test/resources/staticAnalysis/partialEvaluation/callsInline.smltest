package tests.staticAnalysis.partialEvaluation.callsInline

// Helpers ---------------------------------------------------------------------

fun impureFunction()

step pureStep(a: Int) -> result: Int {
    yield result = a;
}

step impureStep(param: Int) -> result: Int {
    impureFunction();
    yield result = param;
}

step variadicStep(first: Int, vararg other: Int) -> result: Int {
    yield result = first;
}

step higherOrderStep(param: Int) -> f: () -> (result: Int) {
    yield f = () -> param;
}


// Tests -----------------------------------------------------------------------

workflow callToPureBlockLambda {
    val lambda = (a) { yield result = a; };
    lambda(1);
}

workflow callToImpureBlockLambda {
    val lambda = (a) { 
        yield result = impureStep(a);
    };
    lambda(1);
}

workflow callToPureExpressionLambda {
    val lambda = (a) -> a;
    lambda(1);
}

workflow callToImpureExpressionLambda {
    val lambda = (a) -> impureStep(a);
    lambda(1);
}

workflow callToPureStep {
    pureStep(1);
}

workflow callToImpureStep {
    impureStep(1);
}

workflow callToStepWithVariadicParameter {
    variadicStep(1);
}

workflow parameterAssignedDuringCallOfBlockLambda {
    ((a) {
        yield result = -a;
    })(1);
}

workflow parameterAssignedDuringCallOfExpressionLambda {
    ((a) -> -a)(1);
}

workflow parameterAssignedDuringCreationOfLambda {
    higherOrderStep(1)();
}

workflow lambdaAsParameter {
    val apply = (f) -> f();

    apply(() -> 1);
}
